@page "/"

@using System.Linq
@using System.Reflection
@using FlareSelect
@using FlareTables
@using Microsoft.AspNetCore.Components.Web

@{
    Random rd = new Random(2);

    List<Option> options = Generate.Contacts(15).Select(v => v.NameOption).ToList();

    List<Option> optionsSingle = options.Select(v => v.Clone()).ToList();

    List<Option> optionsMultiple = new List<Option>();
    foreach (Option option in options)
    {
        option.Selected = rd.Next() % 2 == 0;
        optionsMultiple.Add(option);
    }
}

@functions {

    private TableStateHandler.ValueGetter _valueGetter;
    
    private IEnumerable<Contact> Data { get; set; }
    private TableStateHandler _flareTable;

    protected override void OnInitialized()
    {
        Console.WriteLine("ONINIT");
        _valueGetter = (row, id) => row.GetType().GetProperty(id)?.GetValue(row).ToString();

        Data = Generate.Contacts(25);
        Data.First().Date = new DateTime();
        _flareTable = new TableStateHandler(() => Data.ToList(), StateHasChanged, typeof(Contact));
    }
}

<FlareTablePaginationButtons TableState="@_flareTable"></FlareTablePaginationButtons> 
<FlareTablePaginationSize TableState="@_flareTable"></FlareTablePaginationSize> 
<FlareTableColumnReset TableState="@_flareTable"></FlareTableColumnReset> 

<table> 
    <thead> 
    <tr> 
        @foreach (PropertyInfo field in new Contact().GetType().GetProperties().ToList()) 
        { 
            _flareTable.InitColumn(field.Name); 
            <th>@field.Name</th> 
        } 
    </tr> 
    <tr> 
        @foreach (PropertyInfo field in new Contact().GetType().GetProperties().ToList()) 
        { 
            <th> 
                <FlareTableColumnFilter TableState="@_flareTable" FieldID="@field.Name"></FlareTableColumnFilter> 
            </th> 
        } 
    </tr> 
    </thead> 
    <tbody> 
    @foreach (Contact row in _flareTable.Data()) 
    { 
        <tr> 
            @foreach (PropertyInfo field in row.GetType().GetProperties().ToList()) 
            { 
                <td>@field.GetValue(row)</td> 
            } 
        </tr> 
    } 
    </tbody> 
</table> 

<FlareTableInfo TableState="@_flareTable"></FlareTableInfo> 

<div class="BodyWrapper" style="width: 400px;">
    <FlareSelector Options="@(() => { return optionsSingle; })" Multiple="@false"/>
    <br>
    <FlareSelector Options="@(() => { return optionsMultiple; })" Multiple="@true"/>
    
    <br>
    <br>
    <br>
    <br>
    <br>
    <hr>
    
    <FlareSelector Options="@(() => { return Generate.Contacts(50).Select(v => v.LongOption).ToList(); })" Multiple="@false"/>
    <br>
    <FlareSelector Options="@(() => { return Generate.Contacts(50).Select(v => v.LongOption).ToList(); })" Multiple="@true"/>
</div>
